import{r as d,G as E,aU as k,j as e,D as b,E as I,aV as Y,aW as L}from"./main-BxmUopUZ.js";const A=()=>{const[n,N]=d.useState(null),[o,g]=d.useState(""),[m,x]=d.useState([]),[u,v]=d.useState([]),[y,j]=d.useState(!1),f=d.useRef(null),{profile:r}=E(),w=()=>{var s;(s=f.current)==null||s.scrollIntoView({behavior:"smooth"})};d.useEffect(()=>{w()},[m]);const D=s=>{const t=new Date,a=new Date(s);return a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()},S=s=>{const t=new Date;t.setDate(t.getDate()-1);const a=new Date(s);return a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()},M=s=>{const t={};return s.forEach(l=>{const i=new Date(l.timestamp);let c;D(l.timestamp)?c="Today":S(l.timestamp)?c="Yesterday":c=i.toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),t[c]||(t[c]=[]),t[c].push(l)}),Object.keys(t).sort((l,i)=>{if(l==="Today")return-1;if(i==="Today")return 1;if(l==="Yesterday")return-1;if(i==="Yesterday")return 1;const c=new Date(l),h=new Date(i);return c.getTime()-h.getTime()}).map(l=>({date:l,messages:t[l].sort((i,c)=>new Date(i.timestamp).getTime()-new Date(c.timestamp).getTime())}))};d.useEffect(()=>{var s;n&&F(((s=n.club_id)==null?void 0:s.toString())||"")},[n]),d.useEffect(()=>{v(M(m))},[m]);const F=async s=>{try{j(!0);const t=await k(s);t.status==="success"&&x(t.data.chats||[])}catch(t){console.error("Failed to fetch chat messages:",t),x([])}finally{j(!1)}},T=s=>{N(s)},p=async()=>{var s,t;if(!(!o.trim()||!n))try{await L(((s=n.club_id)==null?void 0:s.toString())||"",o);const a={id:Date.now().toString(),senderId:((t=r==null?void 0:r.id)==null?void 0:t.toString())||"",senderName:(r==null?void 0:r.name)||"",senderAvatar:null,content:o,timestamp:new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),type:"text"};x(l=>[...l,a]),g("")}catch(a){console.error("Failed to send message:",a)}},C=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),p())};return r?e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-xxxl-3 col-lg-4 col-12",children:e.jsxs("div",{className:"box bg-lightest",children:[e.jsx("div",{className:"box-header",children:e.jsx("h4",{className:"box-title",children:"My Clubs"})}),e.jsx("div",{className:"box-body p-0",children:e.jsx("div",{className:"chat-list",children:r.memberships&&r.memberships.length>0?r.memberships.map(s=>e.jsx("div",{className:`chat-item p-20 border-bottom cursor-pointer ${(n==null?void 0:n.club_id)===s.club_id?"bg-primary-light":""}`,onClick:()=>T(s),children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"position-relative",children:[e.jsx("img",{src:s.avatar||"/images/avatar/default.jpg",className:"avatar avatar-lg w-[50px]! h-[50px]! rounded-circle",alt:s.name,onError:t=>{const a=t.target;a.src="/images/avatar/default.jpg"}}),e.jsx("span",{className:"position-absolute bottom-0 end-0 bg-success rounded-circle",style:{width:"12px",height:"12px",border:"2px solid white"}})]}),e.jsxs("div",{className:"ms-15 flex-grow-1",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsx("h6",{className:"mb-0 text-lg! text-[#1C2023] fw-600",children:s.club})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-5",children:[e.jsxs("p",{className:"text-muted mb-0 fs-12",children:["Status: ",s.status]}),e.jsxs("span",{className:"text-muted fs-11",children:["Joined: ",s.joined_at]})]})]})]})},s==null?void 0:s.club_id)):e.jsx("div",{className:"p-20 text-center",children:e.jsx("p",{className:"text-muted",children:"No club memberships found"})})})})]})}),e.jsx("div",{className:"col-xxxl-9 col-lg-8 col-12",children:e.jsx("div",{className:"box bg-lightest",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"box-header",children:e.jsxs("div",{className:"media align-items-top p-0",children:[e.jsxs("div",{className:"position-relative",children:[e.jsx("img",{src:n.avatar||"/images/avatar/default.jpg",className:"avatar avatar-lg rounded-circle",alt:n.club,onError:s=>{const t=s.target;t.src="/images/avatar/default.jpg"}}),e.jsx("span",{className:"position-absolute bottom-0 end-0 bg-success rounded-circle",style:{width:"12px",height:"12px",border:"2px solid white"}})]}),e.jsx("div",{className:"d-lg-flex d-block justify-content-between align-items-center w-p100",children:e.jsxs("div",{className:"media-body mb-lg-0 mb-20",children:[e.jsx("span",{className:"fs-18 text-dark font-bold",children:n.club}),e.jsxs("p",{className:"fs-14 mb-0",children:["Your role: ",n.role]})]})})]})}),e.jsx("div",{className:"box-body",children:e.jsxs("div",{className:"chat-box-one2 h-[360px]! overflow-y-scroll",children:[y?e.jsxs("div",{className:"text-center p-20",children:[e.jsx(b,{className:"text-muted mx-auto fs-24"}),e.jsx("p",{className:"text-muted mt-10",children:"Loading messages..."})]}):u.length>0?u.map(s=>e.jsxs("div",{children:[e.jsx("div",{className:"text-center my-3",children:e.jsx("span",{className:"badge bg-secondary",children:s.date})}),s.messages.map(t=>{var a,l,i;return e.jsxs("div",{children:[e.jsxs("div",{className:`card mt-10 d-inline-block mb-3 me-2 no-shadow max-w-p80 ${t.senderId===((a=r.id)==null?void 0:a.toString())?"float-end bg-primary text-white":"float-start bg-primary-light"}`,children:[e.jsx("div",{className:"position-absolute pt-1 pe-2 r-0",children:e.jsx("span",{className:`text-extra-small ${t.senderId===((l=r.id)==null?void 0:l.toString())?"":"text-muted"}`,children:new Date(t.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex flex-row pb-2",children:[e.jsx("a",{className:"d-flex",href:"#",children:e.jsx("img",{alt:"Profile",src:t.senderAvatar||"/images/avatar/default.jpg",className:"avatar me-10",onError:c=>{const h=c.target;h.src="/images/avatar/default.jpg"}})}),e.jsx("div",{className:"d-flex flex-grow-1 min-width-zero",children:e.jsx("div",{className:"m-2 ps-0 align-self-center d-flex flex-column flex-lg-row justify-content-between",children:e.jsx("div",{className:"min-width-zero",children:e.jsx("p",{className:`mb-0 font-bold fs-16 ${t.senderId===((i=r.id)==null?void 0:i.toString())?"":"text-dark"}`,children:t.senderName})})})})]}),e.jsx("div",{className:"chat-text-start ps-55",children:e.jsx("p",{className:"mb-0 text-semi-muted",children:t.content})})]})]}),e.jsx("div",{className:"clearfix"})]},t.id)})]},s.date)):e.jsxs("div",{className:"text-center p-20",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{className:"w-[20%] mb-10",src:I.empty,alt:"empty"})}),e.jsx("h5",{className:"text-muted",children:"No messages yet"}),e.jsx("p",{className:"text-muted",children:"Start the conversation!"})]}),e.jsx("div",{ref:f})]})}),e.jsx("div",{className:"box-footer no-border",children:e.jsxs("div",{className:"d-md-flex d-block justify-content-between align-items-center bg-[#5F6569] p-5 rounded10 b-1 overflow-hidden",children:[e.jsx("input",{className:"form-control border border-[#D6DADD] bg-[#F8F9FA]! b-0 py-10",type:"text",placeholder:"Type your message...",value:o,onChange:s=>g(s.target.value),onKeyPress:C}),e.jsx("div",{className:"d-flex justify-content-between align-items-center mt-md-0 mt-30",children:e.jsx("button",{type:"button",className:"waves-effect waves-circle ml-2! btn btn-circle bg-primary",onClick:p,disabled:!o.trim(),children:e.jsx("i",{className:"mdi text-white mdi-send"})})})]})})]}):e.jsx("div",{className:"box-body d-flex align-items-center justify-content-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"text-gray-500 mx-auto fs-100 mb-10"}),e.jsx("h5",{className:"text-black",children:"Select a club to start chatting"})]})})})})]}):e.jsx("div",{className:"box-body d-flex align-items-center justify-content-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(b,{className:"text-muted mx-auto fs-24"}),e.jsx("h5",{className:"text-muted",children:"Loading profile..."})]})})};export{A as default};
